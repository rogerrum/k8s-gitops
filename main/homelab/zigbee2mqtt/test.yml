values:
  controllers:
    zigbee:
      annotations:
        reloader.stakater.com/auto: "true"
      containers:
        app:
          image:
            repository: ghcr.io/koenkk/zigbee2mqtt
            tag: 2.3.0@sha256:42de8c55dc578a8404a18c43aeb2b7c75be7988179abe9a8195d99a9e7ebb917
          env:
            TZ: America/New_York
            ZIGBEE2MQTT_DATA: /config
            ZIGBEE2MQTT_CONFIG_HOMEASSISTANT_DISCOVERY_TOPIC: homeassistant
            ZIGBEE2MQTT_CONFIG_HOMEASSISTANT_STATUS_TOPIC: homeassistant/status
            ZIGBEE2MQTT_CONFIG_ADVANCED_LAST_SEEN: ISO_8601
            ZIGBEE2MQTT_CONFIG_ADVANCED_LOG_LEVEL: info # debug
            ZIGBEE2MQTT_CONFIG_ADVANCED_LOG_OUTPUT: '["console"]'
            ZIGBEE2MQTT_CONFIG_AVAILABILITY_ACTIVE_TIMEOUT: 60
            ZIGBEE2MQTT_CONFIG_AVAILABILITY_PASSIVE_TIMEOUT: 2000
            ZIGBEE2MQTT_CONFIG_DEVICE_OPTIONS_RETAIN: "true"
            ZIGBEE2MQTT_CONFIG_FRONTEND_PORT: &port 80
            ZIGBEE2MQTT_CONFIG_FRONTEND_URL: https://zigbee.devbu.io
            ZIGBEE2MQTT_CONFIG_HOMEASSISTANT_ENABLED: true
            ZIGBEE2MQTT_CONFIG_MQTT_INCLUDE_DEVICE_INFORMATION: "true"
            ZIGBEE2MQTT_CONFIG_MQTT_KEEPALIVE: 60
            ZIGBEE2MQTT_CONFIG_MQTT_REJECT_UNAUTHORIZED: "true"
            ZIGBEE2MQTT_CONFIG_MQTT_SERVER: mqtt://emqx.default.svc.cluster.local
            ZIGBEE2MQTT_CONFIG_MQTT_VERSION: 5
            ZIGBEE2MQTT_CONFIG_PERMIT_JOIN: "false"
            ZIGBEE2MQTT_CONFIG_SERIAL_BAUDRATE: 115200
            ZIGBEE2MQTT_CONFIG_SERIAL_DISABLE_LED: "false"
            ZIGBEE2MQTT_CONFIG_SERIAL_ADAPTER: zstack
            ZIGBEE2MQTT_CONFIG_SERIAL_PORT: "/dev/serial/by-id/usb-ITead_Sonoff_Zigbee_3.0_USB_Dongle_Plus_72de2ed2c445ed11a8848da40a86e0b4-if00-port0"
          envFrom:
            - secretRef:
                name: zigbee-secret
          probes:
            liveness:
              enabled: true
            readiness:
              enabled: true
            startup:
              enabled: true
              spec:
                failureThreshold: 30
                periodSeconds: 10
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            capabilities: { drop: ["ALL"] }
          resources:
            requests:
              cpu: 10m
            limits:
              memory: 1Gi
  defaultPodOptions:
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      runAsGroup: 1000
      fsGroup: 1000
      fsGroupChangePolicy: OnRootMismatch
  service:
    app:
      controller: zigbee
      ports:
        http:
          port: *port
  route:
    app:
      hostnames: ["{{ .Release.Name }}.devbu.io"]
      parentRefs:
        - name: internal
          namespace: kube-system
          sectionName: https
      rules:
        - backendRefs:
            - name: *app
              port: *port
  persistence:
    config:
      existingClaim: zigbee
